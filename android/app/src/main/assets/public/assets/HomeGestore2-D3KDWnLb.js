import{_ as _e,g as Re,b as xe,a as Ee,r as s,o as Le,h as D,s as t,u as o,j as Be,i as Ge,a5 as Te,q as Ue,k as Fe,w as qe,l as Ae,e as Oe,m as V,n as B,p as m,t as a,I as G,v as T,x as n,y as He,z as U,A as r,E as je,G as Ke,Y as Ye,U as p,M as c,ab as F,O as q,L as Q,a0 as M,a1 as y,aq as W,ar as Ze,K as X,H as Je,B as ee,C as ue,F as re,P as Qe,R as We,as as Xe,f as de,ap as ce,at as ve,au as fe,av as me,aw as ge,ax as eo,ay as oo,az as ao}from"./index-CM96ScbK.js";const to={class:"div-foto-nome"},lo={class:"image-container"},io=["src"],so={class:"description"},no={class:"div-button-home"},uo={class:"form-container"},ro={class:"form-container"},co={class:"add-photo-container"},vo={class:"menu-photos-container"},fo={class:"menu-photos"},mo=["src"],go={__name:"HomeGestore2",setup(po){const A=Re(),oe=xe(),N=Ee(),S=Be(),pe=Ge();let ae;const O=s("Clicca per caricare una nuova foto");let g=s(!1);const $=s("Nome del Negozio"),_=s("Città del Negozio"),R=s("Via del Negozio"),x=s("Numero di Cellulare"),H=s("path/immagine.jpg"),E=s("Descrizione del Negozio"),L=s(!0);var v=s("");const j=s(!1),K=s(!1),ze=["Lunedì","Martedì","Mercoledì","Giovedì","Venerdì","Sabato","Domenica"],te=s([]),b=s(""),I=s(""),le=s(""),k=s(""),w=s(""),h=s("");var Y=s();const Z=s(!1),z=s([]),Ce=s(Xe),C=s([]),Me=i=>{const e=C.value.indexOf(i);e===-1?(console.log("aggiungo",i),C.value.push(i)):(C.value.splice(e,1),console.log("rimuovo"))},ye=()=>{j.value=!0,b.value=$.value,I.value=R.value,le.value=_.value,k.value=x.value,w.value=E.value},J=()=>{O.value="Clicca per caricare una nuova foto",j.value=!1};function Ne(){K.value=!0}function ie(){K.value=!1}async function be(){try{const i=de(A,"Negozi",v.value);await ce(i,{giorniChiusura:C.value},{merge:!0}),console.log("Giorni di chiusura aggiornati con successo:",te.value),ie(),te.value=[]}catch(i){console.error("Errore durante l'aggiornamento dei giorni di chiusura:",i)}}const f=async(i,e="medium")=>{await(await Te.create({message:i,duration:2e3,color:e,position:"top",cssClass:"custom-toast",buttons:[{icon:"close",role:"cancel"}]})).present()},Ie=async()=>{try{ae=await ve.getPhoto({resultType:fe.Uri,source:me.Photos,quality:90}),Y=ae.webPath,O.value="Immagine caricata con successo. Premi il pulsante salva"}catch(i){f("Errore ","danger")}};async function se(i){return new Promise((e,l)=>{try{fetch(i).then(u=>u.blob()).then(u=>e(u)).catch(u=>l(u))}catch(u){l(u)}})}const ke=async()=>{g.value=!0;var i;const e=l=>l&&l.charAt(0).toUpperCase()+l.slice(1).toLowerCase();try{const l=de(A,"Negozi",v.value),u={nomeNegozio:e(b.value),indirizzoNegozio:e(I.value),cellulareNegozio:k.value,descrizioneNegozio:w.value};if(Y){const d=V(N,"/images/".concat(v.value)),P=await se(Y);await ge(d,P,{contentType:"image/jpeg"}),i=await B(d)}await ce(l,u,{merge:!0}),$.value=b.value,R.value=I.value,_.value=le.value,x.value=k.value,E.value=w.value,i&&(H.value=i),J(),console.log("Modifiche salvate con successo."),f("Modifiche salvate con successo ","danger")}catch(l){f("Errore ","danger"),g.value=!1,console.error("Errore durante il salvataggio delle modifiche:",l)}finally{g.value=!1}},we=()=>{S.push("/gestore/tabs/tab1gestore/inserisciServizi")},he=()=>{S.push("/gestore/tabs/tab1gestore/inserisciferie")},Pe=()=>{S.push("/gestore/tabs/tab1gestore/sceltaOrariLavorativi")};async function De(){try{const i=oe.currentUser;let e=Ue(Fe(A,"Negozi"),qe("proprietarioUid","==",i==null?void 0:i.uid));const u=(await Ae(e)).docs[0].ref,d=await Oe(u);if(d.exists()){v.value=d.id,h.value=d.data().categoriaNegozio,pe.dispatch("setIdDocumentNegozioGestore",v.value),$.value=d.data().nomeNegozio||"",_.value=d.data().cittaNegozio||"",R.value=d.data().indirizzoNegozio||"",x.value=d.data().cellulareNegozio||"",E.value=d.data().descrizioneNegozio||"";const P=V(N,"images/".concat(v.value));H.value=await B(P),L.value=!1,C.value=d.data().giorniChiusura||[]}else S.push("/registrazione/registrazioneClienteGestore/registrazioneNegozio")}catch(i){f("Errore ","danger")}}Le(async()=>{const i=oe.currentUser;if(L.value=!0,i)try{await De()}catch(e){f("Errore ","danger")}L.value=!1});const Ve=async()=>{Z.value=!0;try{const i=V(N,"menuPhotos/".concat(v.value)),e=await eo(i);z.value=[];for(const l of e.items){const u=await B(l);z.value.push({url:u,fullPath:l.fullPath})}}catch(i){f("Errore ","danger")}},ne=()=>{Z.value=!1},Se=async()=>{try{const e=(await ve.getPhoto({resultType:fe.Uri,source:me.Photos,quality:90})).webPath;g.value=!0;const l="".concat(Date.now(),".jpg"),u=V(N,"menuPhotos/".concat(v.value,"/").concat(l)),d=await se(e);await ge(u,d);const P=await B(u);z.value.push({url:P,fullPath:"menuPhotos/".concat(v.value,"/").concat(l)}),g.value=!1}catch(i){f("Errore ","danger"),g.value=!1}},$e=async i=>{try{const e=V(N,i.fullPath);await ao(e),z.value=z.value.filter(l=>l.fullPath!==i.fullPath)}catch(e){f("Errore ","danger")}};return(i,e)=>(m(),D(o(We),null,{default:t(()=>[a(o(U),null,{default:t(()=>[a(o(G),{color:"primary"},{default:t(()=>[a(o(T),null,{default:t(()=>e[11]||(e[11]=[n("Home")])),_:1}),a(o(He),{"is-open":o(g),message:"Please wait...",class:"loading-spinner"},null,8,["is-open"])]),_:1})]),_:1}),a(o(q),null,{default:t(()=>[r("div",to,[r("div",lo,[r("img",{class:"img",alt:"Immagine del negozio",src:H.value},null,8,io),je(a(o(Ye),{class:"progress-bar",type:"indeterminate",color:"primary"},null,512),[[Ke,L.value]])]),r("h1",null,p($.value),1),r("h3",null,p(R.value)+", "+p(_.value),1),r("h4",null,p(x.value),1),r("div",so,[e[12]||(e[12]=r("h6",{class:"h6-description"},"Descrizione",-1)),r("p",null,p(E.value),1)])]),r("div",no,[a(o(c),{class:"custom-button",fill:"outline",onClick:e[0]||(e[0]=l=>ye())},{default:t(()=>e[13]||(e[13]=[n("Modifica informazioni")])),_:1}),h.value=="Servizi di estetica e bellezza"?(m(),D(o(c),{key:0,class:"custom-button",fill:"outline",onClick:e[1]||(e[1]=l=>we())},{default:t(()=>e[14]||(e[14]=[n("Modifica servizi")])),_:1})):F("",!0),h.value=="Servizi di estetica e bellezza"?(m(),D(o(c),{key:1,class:"custom-button",fill:"outline",onClick:e[2]||(e[2]=l=>Pe())},{default:t(()=>e[15]||(e[15]=[n("Modifica orari lavorativi")])),_:1})):F("",!0),a(o(c),{class:"custom-button",fill:"outline",onClick:e[3]||(e[3]=l=>he())},{default:t(()=>e[16]||(e[16]=[n("Inserisci ferie")])),_:1}),h.value=="Alimentari e cibo"?(m(),D(o(c),{key:2,class:"custom-button",fill:"outline",onClick:e[4]||(e[4]=l=>Ne())},{default:t(()=>e[17]||(e[17]=[n("Inserisci Giorno di chiusura")])),_:1})):F("",!0),h.value=="Alimentari e cibo"?(m(),D(o(c),{key:3,class:"custom-button",fill:"outline",onClick:e[5]||(e[5]=l=>Ve())},{default:t(()=>e[18]||(e[18]=[n(" Carica Foto Menu ")])),_:1})):F("",!0)])]),_:1}),a(o(X),{"is-open":j.value,onIonModalDidDismiss:J},{default:t(()=>[a(o(U),null,{default:t(()=>[a(o(G),{color:"primary"},{default:t(()=>[a(o(T),null,{default:t(()=>e[19]||(e[19]=[n("Modifica informazioni")])),_:1}),a(o(Q),{slot:"end"},{default:t(()=>[a(o(c),{onClick:J},{default:t(()=>e[20]||(e[20]=[n("Chiudi")])),_:1})]),_:1})]),_:1})]),_:1}),a(o(q),null,{default:t(()=>[r("div",uo,[a(o(M),{class:"item"},{default:t(()=>[a(o(y),{position:"stacked"},{default:t(()=>e[21]||(e[21]=[n("Immagine del negozio")])),_:1}),a(o(c),{class:"upload-btn",onClick:e[6]||(e[6]=l=>Ie())},{default:t(()=>[n(p(O.value),1)]),_:1})]),_:1}),a(o(M),{class:"item"},{default:t(()=>[a(o(y),{position:"stacked"},{default:t(()=>e[22]||(e[22]=[n("Nome")])),_:1}),a(o(W),{modelValue:b.value,"onUpdate:modelValue":e[7]||(e[7]=l=>b.value=l),class:"input-field"},null,8,["modelValue"])]),_:1}),a(o(M),{class:"item"},{default:t(()=>[a(o(y),{position:"stacked"},{default:t(()=>e[23]||(e[23]=[n("Via")])),_:1}),a(o(W),{modelValue:I.value,"onUpdate:modelValue":e[8]||(e[8]=l=>I.value=l),class:"input-field"},null,8,["modelValue"])]),_:1}),a(o(M),{class:"item"},{default:t(()=>[a(o(y),{position:"stacked"},{default:t(()=>e[24]||(e[24]=[n("Numero di cellulare")])),_:1}),a(o(W),{modelValue:k.value,"onUpdate:modelValue":e[9]||(e[9]=l=>k.value=l),class:"input-field"},null,8,["modelValue"])]),_:1}),a(o(M),{class:"item"},{default:t(()=>[a(o(y),{position:"stacked"},{default:t(()=>e[25]||(e[25]=[n("Descrizione")])),_:1}),a(o(Ze),{modelValue:w.value,"onUpdate:modelValue":e[10]||(e[10]=l=>w.value=l),class:"input-field"},null,8,["modelValue"])]),_:1}),a(o(c),{class:"save-btn",expand:"block",onClick:ke},{default:t(()=>e[26]||(e[26]=[n("Salva modifiche")])),_:1})])]),_:1})]),_:1},8,["is-open"]),a(o(X),{"is-open":Z.value,onIonModalDidDismiss:ne},{default:t(()=>[a(o(U),null,{default:t(()=>[a(o(G),{color:"primary"},{default:t(()=>[a(o(T),null,{default:t(()=>e[27]||(e[27]=[n("Modifica Menu")])),_:1}),a(o(Q),{slot:"end"},{default:t(()=>[a(o(c),{onClick:ne},{default:t(()=>e[28]||(e[28]=[n("Chiudi")])),_:1})]),_:1})]),_:1})]),_:1}),a(o(q),null,{default:t(()=>[r("div",ro,[r("div",co,[a(o(c),{class:"add-photo-btn",fill:"clear",onClick:Se},{default:t(()=>[a(o(Je),{icon:Ce.value,class:"add-icon"},null,8,["icon"])]),_:1})]),r("div",vo,[r("div",fo,[(m(!0),ee(re,null,ue(z.value,(l,u)=>(m(),ee("div",{key:u,class:"menu-photo"},[r("img",{src:l.url,alt:"Foto Menu",class:"img-menu"},null,8,mo),a(o(c),{color:"danger",size:"small",onClick:d=>$e(l)},{default:t(()=>e[29]||(e[29]=[n("Elimina")])),_:2},1032,["onClick"])]))),128))])])])]),_:1})]),_:1},8,["is-open"]),a(o(X),{"is-open":K.value},{default:t(()=>[a(o(U),null,{default:t(()=>[a(o(G),null,{default:t(()=>[a(o(T),null,{default:t(()=>e[30]||(e[30]=[n("Seleziona giorni di chiusura")])),_:1}),a(o(Q),{slot:"end"},{default:t(()=>[a(o(c),{onClick:ie},{default:t(()=>e[31]||(e[31]=[n("Chiudi")])),_:1})]),_:1})]),_:1})]),_:1}),a(o(q),null,{default:t(()=>[a(o(Qe),null,{default:t(()=>[e[33]||(e[33]=r("p",null,"ATTENZIONE:Ricorda che i giorni di chiusura si applicano ad ogni settimana ",-1)),(m(),ee(re,null,ue(ze,l=>a(o(M),{key:l},{default:t(()=>[a(o(y),null,{default:t(()=>[n(p(l),1)]),_:2},1024),a(o(oo),{checked:C.value.includes(l),onIonChange:u=>Me(l)},{default:t(()=>e[32]||(e[32]=[n(">")])),_:2},1032,["checked","onIonChange"])]),_:2},1024)),64))]),_:1}),a(o(c),{expand:"full",onClick:be},{default:t(()=>e[34]||(e[34]=[n(" Salva ")])),_:1})]),_:1})]),_:1},8,["is-open"])]),_:1}))}},Co=_e(go,[["__scopeId","data-v-a6459742"]]);export{Co as default};
