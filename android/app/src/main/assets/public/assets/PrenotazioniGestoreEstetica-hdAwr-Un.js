import{_ as ze,g as we,b as ge,r as v,az as g,a2 as ye,h as J,s as m,u as i,i as he,j as De,q as L,k as b,w as S,l as U,aA as Se,p,t as u,I as Ie,v as Ce,x as H,y as _e,z as Pe,A as c,M as K,aB as ke,U as d,aC as Ge,aD as Q,B as z,C as R,F as V,ab as M,O as be,aE as Me,R as Ne,a5 as Ee,T as X,aF as Ae,f as Te,aG as xe,ak as Fe,aH as $e}from"./index-OGMsN-9i.js";import{A as qe}from"./AlertInformazioniPrenotazione-b5Pl4o3d.js";const Be={class:"month-navigation-container"},Le={class:"month-title"},Ue=["onClick"],He={key:0},Re=["onClick"],Ve={class:"div-informazioni-prenotazione"},je={key:0},Oe={key:1,style:{"font-size":"medium",margin:"5px"}},We={class:"popover-content"},Ye={class:"prenotazione-details"},Ze=80,Je={__name:"PrenotazioniGestoreEstetica",setup(Ke){const ee=he(),y=we();De();const oe=ge(),f=v(!1);let s=g(new Date),I=g([]),C=g(new Map),N=g(new Set),E=g(new Set),_=v(!1);const A=v(null);let T=v("");const P=g(new Set),x=v(!1),j=v(""),k=v([]),O=v(0),F=v(!1),te=()=>F.value=!0,ne=()=>F.value=!1,$=ee.getters.getIdDocumentNegozioGestore;async function h(t){await(await Ee.create({message:t,duration:2e3,position:"top"})).present()}function ae(){x.value=!0}async function re(){await D()}const ie=async(t,o,n)=>{if(o){j.value=n;const e=Te(y,"Prenotazioni",n.id);try{await xe(e,{new:!1}),te()}catch(a){console.error("Errore nell'aggiornamento della prenotazione:",a),await h("Errore nell'aggiornamento della prenotazione.")}}else{const e=[{text:"Annulla",cssClass:"alert-button-cancel"},{text:"Conferma",cssClass:"alert-button-confirm",handler:async l=>{const w=l[0],B=l[1];await de(w,B,t)}}],a=[{type:"textarea",placeholder:"Inserisci il nome del cliente"},{type:"textarea",placeholder:"Inserisci eventuale descrizione"}];await(await Fe.create({header:"Inserisci manualmente la prenotazione",buttons:e,inputs:a})).present()}};function q(t){const o=t.getMonth(),n=t.getFullYear(),e=new Date(n,o,1),a=new Date(n,o+1,0),r=[];for(;e<=a;){const l=new Intl.DateTimeFormat("it-IT",{weekday:"long"}).format(e),w={nomeGiornoSettimana:l.charAt(0).toUpperCase()+l.slice(1),numeroGiorno:e.getDate()};r.push(w),e.setDate(e.getDate()+1)}return r}async function G(){try{f.value=!0;const t=oe.currentUser.uid,o=L(b(y,"Negozi"),S("proprietarioUid","==",t)),n=await U(o);if(n.empty)console.error("Nessun documento trovato per uiduser"),await h("Nessun orario trovato per il tuo negozio.");else{const a=n.docs[0].data().orariLavorativi;C=new Map(Object.entries(a)),C.forEach((r,l)=>{C.set(l,r.sort(se))}),le(ce(s))}f.value=!1}catch(t){f.value=!1,console.error("Errore nel recupero degli orari:",t),await h("Errore durante il recupero degli orari.")}}function se(t,o){const[n,e]=t.split(":").map(Number),[a,r]=o.split(":").map(Number);return n!==a?n-a:e-r}function le(t){N.clear();const o=t.nomeGiornoSettimana;C.forEach((n,e)=>{e==o&&n.forEach(a=>{N.add(a)})})}function ce(t){const o=new Intl.DateTimeFormat("it-IT",{weekday:"long"}).format(t);return{nomeGiornoSettimana:o.charAt(0).toUpperCase()+o.slice(1),numeroGiorno:t.getDate()}}async function D(){try{f.value=!0,E.clear(),k.value=[];const t=L(b(y,"Prenotazioni"),S("idDocumentNegozio","==",$),S("dataPrenotazione",">=",s),S("dataPrenotazione","<",new Date(s.getTime()+24*60*60*1e3))),o=L(b(y,"Prenotazioni"),S("idDocumentNegozio","==",$));(await U(o)).forEach(a=>{const r=a.data();r.id=a.id,r.new===!0&&k.value.push(r)}),O.value=k.value.length,(await U(t)).forEach(a=>{const r=a.data();r.id=a.id,E.add(r)}),ue(E,N),_.value=!0,f.value=!1}catch(t){f.value=!1,console.error("Errore nel recupero delle prenotazioni:",t),await h("Errore nel recupero delle prenotazioni.")}}function ue(t,o){P.clear();try{let n=Array.from(o).sort();for(let e=0;e<n.length;e++){let a=n[e],r=Array.from(t).find(l=>l.oraInizio===a);if(r){const l=r.durataServizioSelezionato,w={prenotato:!0,oraInizio:a,durata:l,sceltaUtente:r.servizioSelezionato,nomeCliente:r.nomeCliente,prenotazione:r,new:r.new};P.add(w);let B=Math.floor(l/15)-1;e+=B}else{const l={prenotato:!1,oraInizio:a,durata:15,sceltaUtente:"",nomeCliente:"",prenotazione:""};P.add(l)}}}catch(n){console.log(n)}}async function de(t,o,n){try{const e={dataPrenotazione:s,idDocumentNegozio:$,oraInizio:n,nomeCliente:t,servizioSelezionato:o,durataServizioSelezionato:15};await $e(b(y,"Prenotazioni"),e),await G(),await D()}catch(e){console.error("Errore durante l'inserimento della prenotazione:",e),await h("Errore durante l'inserimento della prenotazione.")}}const W=t=>t<10?"0".concat(t):t.toString(),pe=(t,o)=>{const[n,e]=t.split(":").map(Number),a=new Date;return a.setHours(n),a.setMinutes(e+o),"".concat(W(a.getHours()),":").concat(W(a.getMinutes()))};function me(t){return t/15*Ze+"px"}async function Y(t){_.value=!1;const o=new Date(s);o.setMonth(o.getMonth()+t),s=o,T=new Intl.DateTimeFormat("it-IT",{month:"long"}).format(s),I=q(s),await G(),await D(),_.value=!0,Z(s.getDate())}function Z(t){if(A.value){const o=A.value,n=o.children[t];if(n){const e=n.offsetLeft-o.offsetLeft-300;o.scrollLeft=e}}}async function fe(t){s.setDate(t.numeroGiorno),I=q(s),await G(),await D()}function ve(t){if(!t||typeof t!="object")return"Data non valida";const o=t.seconds*1e3+Math.floor(t.nanoseconds/1e6),n=new Date(o),e=String(n.getDate()).padStart(2,"0"),a=String(n.getMonth()+1).padStart(2,"0"),r=n.getFullYear(),l=String(n.getHours()).padStart(2,"0"),w=String(n.getMinutes()).padStart(2,"0");return"".concat(e,"/").concat(a,"/").concat(r," ore ").concat(l,":").concat(w)}return ye(async()=>{s.setHours(0,0,0,0),T=new Intl.DateTimeFormat("it-IT",{month:"long"}).format(s),I=q(s),await G(),await D(),Z(s.getDate())}),(t,o)=>{const n=Se("ion-icon");return p(),J(i(Ne),null,{default:m(()=>[u(i(Pe),null,{default:m(()=>[u(i(Ie),{color:"primary"},{default:m(()=>[u(i(Ce),null,{default:m(()=>o[3]||(o[3]=[H("Prenotazioni")])),_:1}),u(i(_e),{"is-open":f.value,message:"Attendere prego...",spinner:"crescent"},null,8,["is-open"])]),_:1})]),_:1}),u(i(be),{class:"ion-padding content-custom"},{default:m(()=>[c("div",Be,[u(i(K),{onClick:o[0]||(o[0]=e=>Y(-1)),class:"navigation-button",fill:"clear",disabled:f.value},{default:m(()=>[u(n,{icon:i(ke)},null,8,["icon"])]),_:1},8,["disabled"]),c("h1",Le,d(i(T)),1),u(i(K),{onClick:o[1]||(o[1]=e=>Y(1)),fill:"clear",class:"navigation-button",disabled:f.value},{default:m(()=>[u(n,{icon:i(Ge)},null,8,["icon"])]),_:1},8,["disabled"])]),u(i(Q),{color:"warning",onClick:ae},{default:m(()=>[H(" Hai "+d(O.value)+" nuove prenotazioni ",1)]),_:1}),c("div",{class:"div-contenitore-giorni",ref_key:"contenitoreGiorni",ref:A},[(p(!0),z(V,null,R(i(I),(e,a)=>(p(),z("div",{class:X(["div-giorno",{"giorno-selezionato":i(s).getDate()===e.numeroGiorno}]),key:a,onClick:r=>fe(e)},d(e.nomeGiornoSettimana)+" "+d(e.numeroGiorno),11,Ue))),128))],512),i(_)?(p(),z("div",He,[(p(!0),z(V,null,R(Array.from(P),(e,a)=>(p(),z("div",{key:a,class:"div-contenitore-orario",onClick:r=>ie(e.oraInizio,e.prenotato,e.prenotazione)},[c("div",{class:X({"div-orario":!e.prenotato,"div-orario-prenotato":e.prenotato}),style:Ae({height:me(e.durata/2)})},d(e.oraInizio)+" / "+d(pe(e.oraInizio,e.durata)),7),c("div",Ve,[e.prenotato?(p(),z("div",je,d(e.nomeCliente),1)):M("",!0),e.prenotato?(p(),z("div",Oe," Servizio: "+d(e.sceltaUtente.nome),1)):M("",!0)]),e.new?(p(),J(i(Q),{key:0,color:"warning"},{default:m(()=>o[4]||(o[4]=[H("New")])),_:1})):M("",!0)],8,Re))),128))])):M("",!0)]),_:1}),u(i(Me),{"is-open":x.value,onIonPopoverDidDismiss:o[2]||(o[2]=e=>x.value=!1)},{default:m(()=>[c("div",We,[o[7]||(o[7]=c("h3",null,"Nuove Prenotazioni",-1)),c("ul",null,[(p(!0),z(V,null,R(k.value,(e,a)=>(p(),z("li",{key:a,class:"prenotazione-item"},[c("div",Ye,[c("strong",null,"Data: "+d(ve(e.dataPrenotazione)),1),o[5]||(o[5]=c("br",null,null,-1)),c("span",null,d(e.nomeCliente)+" "+d(e.cognomeCliente),1),o[6]||(o[6]=c("br",null,null,-1)),c("span",null,"Servizio: "+d(e.servizioSelezionato),1)])]))),128))])])]),_:1},8,["is-open"]),u(qe,{"is-open":F.value,prenotazioneSelected:j.value,onCloseModal:ne,onRicaricaOrari:re},null,8,["is-open","prenotazioneSelected"])]),_:1})}}},eo=ze(Je,[["__scopeId","data-v-00835bf0"]]);export{eo as default};
