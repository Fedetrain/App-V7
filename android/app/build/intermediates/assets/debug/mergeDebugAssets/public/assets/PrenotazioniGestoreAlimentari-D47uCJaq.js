import{_ as pe,g as ke,b as ye,r as C,o as Ie,aI as Pe,aJ as be,h as P,s,u as e,k as ze,q as we,w as Ae,l as De,a3 as ce,aA as Oe,p as d,t,I as re,aK as Te,aL as G,a1 as w,x as m,U as c,z as de,B as p,P as H,F as V,C as $,ab as y,K,v as xe,L as Ve,M as b,H as r,N as $e,O as ue,A as n,y as Ee,Q as Me,R as Ne,a0 as Q,aM as W,aN as j,aO as ve,aD as J,aP as X,$ as Y,ac as Z,aQ as me,ae as ee,aR as Se,aS as Be,aT as Le,T as Re,aU as Ue,aG as E,f as M}from"./index-CQjVl0ED.js";import{A as qe}from"./AlertInformazioniPrenotazione-BgwcaTZ5.js";const Fe={key:0,class:"section"},Ge={class:"prenotazione-header"},He={class:"header-content"},Ke={class:"customer-name"},Qe={class:"booking-time"},We={class:"prenotazione-details"},je={class:"datetime-container"},Je={class:"info-grid"},Xe={key:0,class:"info-item-address-info"},Ye={class:"info-text"},Ze={class:"info-item"},et={class:"info-text"},tt={class:"info-item"},at={class:"info-text"},ot={class:"prenotazione-actions"},nt={class:"decision-buttons"},st={key:1,class:"section"},it={class:"prenotazione-header"},lt={class:"header-content"},ct={class:"customer-name"},rt={class:"booking-time"},dt={class:"prenotazione-details"},ut={class:"datetime-container"},vt={class:"info-grid"},mt={key:0,class:"info-item-address-info"},ft={class:"info-text"},_t={class:"info-item"},gt={class:"info-text"},ht={class:"info-item"},Ct={class:"info-text"},pt={class:"prenotazione-actions"},kt={key:2,class:"section"},yt={class:"prenotazione-header"},It={class:"header-content"},Pt={class:"customer-name"},bt={class:"booking-time"},zt={class:"prenotazione-details"},wt={class:"datetime-container"},At={class:"info-grid"},Dt={key:0,class:"info-item-address-info"},Ot={class:"info-text"},Tt={class:"info-item"},xt={class:"info-text"},Vt={class:"info-item"},$t={class:"prenotazione-actions"},Et={class:"order-container"},Mt={class:"order-list"},Nt={class:"item-info"},St={class:"item-name"},Bt={class:"item-quantity"},Lt={__name:"PrenotazioniGestoreAlimentari",setup(Rt){const A=ke(),fe=ye(),D=C("daAccettare"),z=C([]),I=C([]),T=C([]),N=C(!1),S=C([]),B=C(!1),te=C(null),g=C(!1),h=C(!1),k=C(""),L=i=>{var o;try{const v=((o=i==null?void 0:i.toDate)==null?void 0:o.call(i))||new Date(i);return new Intl.DateTimeFormat("it-IT",{day:"2-digit",month:"2-digit",year:"numeric"}).format(v)}catch(v){return console.error("Error formatting date:",v),"Data non disponibile"}},ae=i=>(i==null?void 0:i.reduce((o,v)=>o+(v.quantity||0),0))||0,O=async()=>{const i=fe.currentUser;if(i){g.value=!0;try{const o=ze(A,"Prenotazioni"),v=we(o,Ae("proprietarioUid","==",i.uid)),a=await De(v),u=(l=>l.map(_=>({id:_.id,..._.data(),dataPrenotazione:_.data().dataPrenotazione||ce.now()})))(a.docs);z.value=u.filter(l=>!l.stato||l.stato==="Da accettare").sort((l,_)=>l.dataPrenotazione-_.dataPrenotazione),I.value=u.filter(l=>l.stato==="Accettato").sort((l,_)=>l.dataPrenotazione-_.dataPrenotazione),T.value=u.filter(l=>l.stato==="Completato").sort((l,_)=>l.dataPrenotazione-_.dataPrenotazione)}catch(o){console.error("Fetch error:",o),k.value="Errore nel caricamento delle prenotazioni",h.value=!0}finally{g.value=!1}}},_e=async i=>{g.value=!0;try{await E(M(A,"Prenotazioni",i),{stato:"Accettato"}),await O(),k.value="Prenotazione accettata con successo",h.value=!0}catch(o){console.error("Accept error:",o),k.value="Errore durante l'accettazione",h.value=!0}finally{g.value=!1}},ge=async i=>{g.value=!0;try{await E(M(A,"Prenotazioni",i),{stato:"Rifiutata"}),await O(),k.value="Prenotazione rifiutata con successo",h.value=!0}catch(o){console.error("Reject error:",o),k.value="Errore durante il rifiuto",h.value=!0}finally{g.value=!1}},he=async i=>{g.value=!0;try{await E(M(A,"Prenotazioni",i.id),{stato:"Completato"}),T.value.push(i),I.value=I.value.filter(o=>o.id!==i.id),k.value="Ordine completato con successo",h.value=!0}catch(o){console.error("Complete error:",o),k.value="Errore durante il completamento",h.value=!0}finally{g.value=!1}},oe=async(i,o)=>{g.value=!0;try{let v=o.detail.value;if(![...z.value,...I.value].find(q=>q.id===i))throw new Error("Prenotazione non trovata");const u=new Date().toISOString().split("T")[0],l="".concat(u,"T").concat(v,":00"),_=new Date(l);if(isNaN(_.getTime()))throw new Error("La data generata non Ã¨ valida");const ie=ce.fromDate(_);await E(M(A,"Prenotazioni",i),{dataPrenotazione:ie});const le=q=>q.map(F=>F.id===i?{...F,dataPrenotazione:ie}:F);z.value=le(z.value),I.value=le(I.value),k.value="Orario modificato con successo",h.value=!0}catch(v){console.error("Errore durante la modifica dell'orario:",v),k.value="Errore nella modifica dell'orario",h.value=!0}finally{g.value=!1}},R=i=>{S.value=i.map(o=>({...o,fatto:!1})),N.value=!0},ne=()=>{N.value=!1,S.value=[]},U=i=>{te.value=i,B.value=!0};function Ce(){B.value=!1}let x=null;const se=()=>{x=setInterval(async()=>{await O()},5e4)};return Ie(async()=>{await O(),se()}),Pe(async()=>{await O(),se()}),be(()=>{x&&(clearInterval(x),x=null)}),(i,o)=>{const v=Oe("ng-template");return d(),P(e(Ne),null,{default:s(()=>[t(e(de),{class:"sticky-header"},{default:s(()=>[t(e(re),{color:"primary"},{default:s(()=>[t(e(Te),{modelValue:D.value,"onUpdate:modelValue":o[0]||(o[0]=a=>D.value=a),onIonChange:i.segmentChanged,class:"custom-segment"},{default:s(()=>[t(e(G),{value:"accettati",class:"segment-button"},{default:s(()=>[t(e(w),{class:"segment-label"},{default:s(()=>[m("In corso ("+c(I.value.length)+")",1)]),_:1})]),_:1}),t(e(G),{value:"daAccettare",class:"segment-button"},{default:s(()=>[t(e(w),{class:"segment-label"},{default:s(()=>[m("Nuovi ("+c(z.value.length)+")",1)]),_:1})]),_:1}),t(e(G),{value:"Completati",class:"segment-button"},{default:s(()=>[t(e(w),{class:"segment-label"},{default:s(()=>[m("Completati ("+c(T.value.length)+")",1)]),_:1})]),_:1})]),_:1},8,["modelValue","onIonChange"])]),_:1})]),_:1}),t(e(ue),{class:"ion-padding-horizontal"},{default:s(()=>[D.value==="daAccettare"?(d(),p("div",Fe,[t(e(H),{lines:"none"},{default:s(()=>[(d(!0),p(V,null,$(z.value,a=>(d(),P(e(Q),{key:a.id,class:"prenotazione-item"},{default:s(()=>[t(e(w),{class:"ion-text-wrap"},{default:s(()=>{var f,u;return[n("div",Ge,[n("div",He,[n("h2",Ke,c(a.nomeCliente),1),t(e(W),{class:"customer-avatar",onClick:l=>U(a)},{default:s(()=>o[3]||(o[3]=[n("img",{alt:"Avatar",src:"https://ionicframework.com/docs/img/demos/avatar.svg"},null,-1)])),_:2},1032,["onClick"])]),n("time",Qe,c(L(a.dataPrenotazione)),1)]),n("div",We,[n("div",je,[t(e(j),{datetime:"datetime-"+a.id,class:"datetime-button"},null,8,["datetime"]),t(e(K),{keepContentsMounted:"true"},{default:s(()=>[t(v,null,{default:s(()=>[t(e(ve),{id:"datetime-"+a.id,presentation:"time",value:a.dataPrenotazione.toDate().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),onIonChange:l=>oe(a.id,l),class:"time-picker"},null,8,["id","value","onIonChange"])]),_:2},1024)]),_:2},1024)]),n("div",Je,[a.consegnaACasa?(d(),p("div",Xe,[a.consegnaACasa?(d(),P(e(J),{key:0,color:"warning",class:"delivery-badge"},{default:s(()=>[t(e(r),{icon:e(X),class:"badge-icon"},null,8,["icon"]),o[4]||(o[4]=m(" A domicilio "))]),_:1})):y("",!0),t(e(r),{icon:e(Y),class:"info-icon"},null,8,["icon"]),n("span",Ye,c((f=a.indirizzoConsegna)==null?void 0:f.via)+" "+c((u=a.indirizzoConsegna)==null?void 0:u.civico),1)])):y("",!0),n("div",Ze,[t(e(r),{icon:e(Z),class:"info-icon"},null,8,["icon"]),n("span",et,c(a.noteAggiuntive||"Nessuna nota aggiuntiva"),1)]),n("div",tt,[t(e(r),{icon:e(me),class:"info-icon"},null,8,["icon"]),n("span",at,"Totale: "+c(ae(a.ordine)),1)])])]),n("div",ot,[t(e(b),{fill:"outline",onClick:l=>R(a.ordine),class:"action-button"},{default:s(()=>[t(e(r),{slot:"start",icon:e(ee)},null,8,["icon"]),o[5]||(o[5]=m(" Dettaglio ordine "))]),_:2},1032,["onClick"]),n("div",nt,[t(e(b),{color:"success",onClick:l=>_e(a.id),class:"decision-button"},{default:s(()=>[t(e(r),{slot:"start",icon:e(Se)},null,8,["icon"]),o[6]||(o[6]=m(" Accetta "))]),_:2},1032,["onClick"]),t(e(b),{color:"danger",onClick:l=>ge(a.id),class:"decision-button"},{default:s(()=>[t(e(r),{slot:"start",icon:e(Be)},null,8,["icon"]),o[7]||(o[7]=m(" Rifiuta "))]),_:2},1032,["onClick"])])])]}),_:2},1024)]),_:2},1024))),128))]),_:1})])):y("",!0),D.value==="accettati"?(d(),p("div",st,[t(e(H),{lines:"none"},{default:s(()=>[(d(!0),p(V,null,$(I.value,a=>(d(),P(e(Q),{key:a.id,class:"prenotazione-item elevation"},{default:s(()=>[t(e(w),{class:"ion-text-wrap"},{default:s(()=>{var f,u;return[n("div",it,[n("div",lt,[n("h2",ct,c(a.nomeCliente),1),t(e(W),{class:"customer-avatar",onClick:l=>U(a)},{default:s(()=>o[8]||(o[8]=[n("img",{alt:"Avatar",src:"https://ionicframework.com/docs/img/demos/avatar.svg"},null,-1)])),_:2},1032,["onClick"])]),n("time",rt,c(L(a.dataPrenotazione)),1)]),n("div",dt,[n("div",ut,[t(e(j),{datetime:"datetime-"+a.id,class:"datetime-button"},null,8,["datetime"]),t(e(K),{keepContentsMounted:"true"},{default:s(()=>[t(v,null,{default:s(()=>[t(e(ve),{id:"datetime-"+a.id,presentation:"time",value:a.dataPrenotazione.toDate().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),onIonChange:l=>oe(a.id,l),class:"time-picker"},null,8,["id","value","onIonChange"])]),_:2},1024)]),_:2},1024)]),n("div",vt,[a.consegnaACasa?(d(),p("div",mt,[a.consegnaACasa?(d(),P(e(J),{key:0,color:"warning",class:"delivery-badge"},{default:s(()=>[t(e(r),{icon:e(X),class:"badge-icon"},null,8,["icon"]),o[9]||(o[9]=m(" A domicilio "))]),_:1})):y("",!0),t(e(r),{icon:e(Y),class:"info-icon"},null,8,["icon"]),n("span",ft,c((f=a.indirizzoConsegna)==null?void 0:f.via)+" "+c((u=a.indirizzoConsegna)==null?void 0:u.civico),1)])):y("",!0),n("div",_t,[t(e(r),{icon:e(Z),class:"info-icon"},null,8,["icon"]),n("span",gt,c(a.noteAggiuntive||"Nessuna nota aggiuntiva"),1)]),n("div",ht,[t(e(r),{icon:e(me),class:"info-icon"},null,8,["icon"]),n("span",Ct,"Totale: "+c(ae(a.ordine)),1)])])]),n("div",pt,[t(e(b),{fill:"outline",onClick:l=>R(a.ordine),class:"action-button"},{default:s(()=>[t(e(r),{slot:"start",icon:e(ee)},null,8,["icon"]),o[10]||(o[10]=m(" Dettaglio ordine "))]),_:2},1032,["onClick"]),t(e(b),{color:"secondary",onClick:l=>he(a),class:"complete-button"},{default:s(()=>[t(e(r),{slot:"start",icon:e(Le)},null,8,["icon"]),o[11]||(o[11]=m(" Completa Ordine "))]),_:2},1032,["onClick"])])]}),_:2},1024)]),_:2},1024))),128))]),_:1})])):y("",!0),D.value==="Completati"?(d(),p("div",kt,[t(e(H),{lines:"none"},{default:s(()=>[(d(!0),p(V,null,$(T.value,a=>(d(),P(e(Q),{key:a.id,class:"prenotazione-item"},{default:s(()=>[t(e(w),{class:"ion-text-wrap"},{default:s(()=>{var f,u;return[n("div",yt,[n("div",It,[n("h2",Pt,c(a.nomeCliente),1),t(e(W),{class:"customer-avatar",onClick:l=>U(a)},{default:s(()=>o[12]||(o[12]=[n("img",{alt:"Avatar",src:"https://ionicframework.com/docs/img/demos/avatar.svg"},null,-1)])),_:2},1032,["onClick"])]),n("time",bt,c(L(a.dataPrenotazione)),1)]),n("div",zt,[n("div",wt,[t(e(j),{datetime:"datetime-"+a.id,class:"datetime-button",disabled:""},null,8,["datetime"])]),n("div",At,[a.consegnaACasa?(d(),p("div",Dt,[a.consegnaACasa?(d(),P(e(J),{key:0,color:"warning",class:"delivery-badge"},{default:s(()=>[t(e(r),{icon:e(X),class:"badge-icon"},null,8,["icon"]),o[13]||(o[13]=m(" A domicilio "))]),_:1})):y("",!0),t(e(r),{icon:e(Y),class:"info-icon"},null,8,["icon"]),n("span",Ot,c((f=a.indirizzoConsegna)==null?void 0:f.via)+" "+c((u=a.indirizzoConsegna)==null?void 0:u.civico),1)])):y("",!0),n("div",Tt,[t(e(r),{icon:e(Z),class:"info-icon"},null,8,["icon"]),n("span",xt,c(a.noteAggiuntive||"Nessuna nota aggiuntiva"),1)]),n("div",Vt,[t(e(r),{icon:i.pizzaOutline,class:"info-icon"},null,8,["icon"])])])]),n("div",$t,[t(e(b),{fill:"outline",onClick:l=>R(a.ordine),class:"action-button"},{default:s(()=>[t(e(r),{slot:"start",icon:e(ee)},null,8,["icon"]),o[14]||(o[14]=m(" Rivedi ordine "))]),_:2},1032,["onClick"])])]}),_:2},1024)]),_:2},1024))),128))]),_:1})])):y("",!0),t(e(K),{"is-open":N.value,onDidDismiss:ne,class:"order-modal"},{default:s(()=>[t(e(de),null,{default:s(()=>[t(e(re),{color:"primary"},{default:s(()=>[t(e(xe),null,{default:s(()=>o[15]||(o[15]=[m("Dettaglio Ordine")])),_:1}),t(e(Ve),{slot:"end"},{default:s(()=>[t(e(b),{onClick:ne,class:"close-button"},{default:s(()=>[t(e(r),{icon:e($e)},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),t(e(ue),{class:"ion-padding"},{default:s(()=>[n("div",Et,[n("ul",Mt,[(d(!0),p(V,null,$(S.value,(a,f)=>(d(),p("li",{key:f,class:Re(["order-item",{"item-completed":a.fatto}])},[t(e(Ue),{modelValue:a.fatto,"onUpdate:modelValue":u=>a.fatto=u,class:"order-checkbox",color:"primary"},null,8,["modelValue","onUpdate:modelValue"]),n("div",Nt,[n("span",St,c(a.name),1),n("span",Bt,"x"+c(a.quantity),1)])],2))),128))]),o[16]||(o[16]=n("div",{class:"order-summary"},[n("span",{class:"total-label"},"Totale articoli:")],-1))])]),_:1})]),_:1},8,["is-open"]),t(e(Ee),{"is-open":g.value,message:"Elaborazione in corso...",spinner:"circles",class:"custom-loading"},null,8,["is-open"]),t(e(Me),{"is-open":h.value,message:k.value,duration:3e3,onDidDismiss:o[1]||(o[1]=a=>h.value=!1),position:"top",class:"custom-toast"},null,8,["is-open","message"])]),_:1}),t(qe,{"is-open":B.value,prenotazioneSelected:te.value,onCloseModal:o[2]||(o[2]=a=>Ce())},null,8,["is-open","prenotazioneSelected"])]),_:1})}}},Ft=pe(Lt,[["__scopeId","data-v-e8f3f469"]]);export{Ft as default};
