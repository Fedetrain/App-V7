import{_ as G,b as Q,g as Y,r as w,d as ee,a2 as te,a3 as O,k as E,q,w as D,a4 as oe,l as A,a5 as ae,h as T,s as l,u as e,f as S,e as ne,p as r,t as a,I as B,v as L,x as v,z as ie,y as se,B as u,F as M,C as V,H as c,a6 as le,A as o,K as re,L as ce,M as H,N as de,O as F,U as s,R as ue,V as me,W as fe,X as ge,a7 as _e,a8 as pe,Z as ze,a9 as ye,$ as ve,aa as he,ab as _,T as U,ac as we,ad as De,ae as ke,af as Ie,ag as Ne,ah as Pe,ai as Ce,aj as be,ak as xe,al as Oe}from"./index-Bp7GJEX9.js";const Ee={key:0,class:"cards-container"},qe={class:"header-content"},Ae={class:"booking-time-container"},Te={class:"booking-time"},Se={class:"info-grid"},Be={class:"info-item"},Le={class:"info-item"},Me={class:"info-item highlight"},Ve={key:0},He={key:0,class:"order-details"},Fe={class:"additional-info"},Ue={key:0,class:"info-note"},Re={key:1,class:"info-warning"},$e={class:"action-bar"},je={key:0,class:"queue-info"},Je={key:1,class:"service-details"},Ke={style:{display:"flex","align-items":"center",gap:"20px","font-size":"1.2rem"}},We={style:{display:"flex","align-items":"center",gap:"8px"}},Xe={style:{display:"flex","align-items":"center",gap:"8px"}},Ze={style:{display:"flex","align-items":"center",gap:"8px"}},Ge={key:0,class:"comment-box"},Qe={key:1,class:"empty-state"},Ye={class:"modal-content"},et={class:"order-list-container"},tt={class:"item-info"},ot={class:"item-name"},at={class:"item-quantity"},nt={key:0,class:"item-ingredients"},it={class:"order-summary"},st={class:"total-items"},lt={__name:"PrenotazioniCliente",setup(rt){const P=Q(),h=Y(),C=P.currentUser&&P.currentUser.uid,k=w([]),g=w(!1),I=w(!1),N=w([]),b=()=>{I.value=!1},R=n=>{try{N.value=typeof n=="string"?JSON.parse(n):n,I.value=!0}catch(i){f("Errore nella visualizzazione dell'ordine"),console.error("Errore parsing ordine:",i)}};function $(){return N.value.reduce((n,i)=>n+i.quantity,0)}const j=n=>{const i={day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"};return new Date(n.toMillis()).toLocaleString("it-IT",i)},J=ee(()=>k.value.length===0),K=n=>({"Da accettare":"status-pending",Accettato:"status-accepted",Completato:"status-completed"})[n];async function W(n){const i=new Date(n.toMillis()),t=new Date(i);t.setHours(0,0,0,0),new Date(i).setHours(23,59,59,999);const p=q(E(h,"Prenotazioni"),D("dataPrenotazione",">=",O.fromDate(t)),D("dataPrenotazione","<",n),D("stato","==","Accettato"));return(await A(p)).size}async function X(n){try{const i=S(h,"Negozi",n),t=await ne(i);return t.exists()?t.data():(console.error("Nessun documento trovato per il negozio con ID:",n),null)}catch(i){return console.error("Errore durante il recupero del negozio:",i),null}}const Z=async n=>{await(await xe.create({header:"Conferma eliminazione",message:"Sei sicuro di voler eliminare questa prenotazione?",buttons:[{text:"Annulla",role:"cancel",cssClass:"secondary",handler:()=>console.log("Eliminazione annullata")},{text:"Elimina",handler:async()=>{try{if(n.stato=="Accettato")return f("Non puoi eliminare questa prenotazione. L'ordine è già in preparazione.");const t=new Date,m=new Date(n.dataPrenotazione.toMillis());if(n.oraInizio){const[p,z]=n.oraInizio.split(":").map(Number);if(m.setHours(p,z),(m.getTime()-t.getTime())/(1e3*60*60)<=2)return f("Non è possibile eliminare la prenotazione. Meno di 2 ore all'inizio del servizio.")}g.value=!0,await Oe(S(h,"Prenotazioni",n.idDocumentPrenotazione)),f("Prenotazione eliminata con successo"),await x()}catch(t){console.error("Errore durante l'eliminazione:",t),f("Si è verificato un errore durante l'eliminazione.")}finally{g.value=!1}}}]})).present()};te(async()=>{if(g.value=!0,!C){console.error("UID non disponibile. L'utente potrebbe non essere autenticato."),f("Errore: utente non autenticato."),g.value=!1;return}await x()});async function x(){try{const n=new Date,i=O.fromDate(n),t=E(h,"Prenotazioni"),m=q(t,D("idDocumentCliente","==",C),oe("dataPrenotazione")),p=await A(m);k.value=await Promise.all(p.docs.map(async z=>{const d=z.data();d.idDocumentPrenotazione=z.id;const y=await X(d.idDocumentNegozio);return y&&(d.nomeNegozio=y.nomeNegozio,d.cellulareNegozio=y.cellulareNegozio,d.cittaNegozio=y.cittaNegozio,d.indirizzoNegozio=y.indirizzoNegozio),d.ordine&&(d.stato=d.stato||"Da accettare"),d.stato==="Accettato"&&(d.prenotazioniPrima=await W(d.dataPrenotazione)),d}))}catch(n){console.error("Errore durante il recupero delle prenotazioni:",n),f("Errore durante il recupero delle prenotazioni")}finally{g.value=!1}}async function f(n){await(await ae.create({message:n,duration:2e3})).present()}return(n,i)=>(r(),T(e(ue),null,{default:l(()=>[a(e(ie),null,{default:l(()=>[a(e(B),{color:"primary"},{default:l(()=>[a(e(L),{class:"toolbar-title"},{default:l(()=>i[0]||(i[0]=[v("Le tue prenotazioni")])),_:1})]),_:1})]),_:1}),a(e(se),{"is-open":g.value,message:"Caricamento...",spinner:"crescent",class:"custom-loading"},null,8,["is-open"]),a(e(F),{class:"ion-padding-horizontal"},{default:l(()=>[J.value?(r(),u("div",Qe,[a(e(c),{icon:e(le),class:"empty-icon"},null,8,["icon"]),i[2]||(i[2]=o("p",{class:"empty-text"},"Nessuna prenotazione in programma",-1))])):(r(),u("div",Ee,[(r(!0),u(M,null,V(k.value,t=>(r(),T(e(me),{key:t.dataPrenotazione,class:"custom-card animated-card"},{default:l(()=>[a(e(fe),{class:"card-header"},{default:l(()=>[o("div",qe,[a(e(ge),{class:"shop-title"},{default:l(()=>[v(s(t.nomeNegozio)+" ",1),a(e(c),{icon:e(_e),class:"trash-icon",onClick:m=>Z(t)},null,8,["icon","onClick"])]),_:2},1024),o("div",Ae,[a(e(c),{icon:e(pe),class:"time-icon"},null,8,["icon"]),o("span",Te,s(j(t.dataPrenotazione)),1)])])]),_:2},1024),a(e(ze),{class:"card-body"},{default:l(()=>[o("div",Se,[o("div",Be,[a(e(c),{icon:e(ye),class:"info-icon"},null,8,["icon"]),o("span",null,s(t.cellulareNegozio),1)]),o("div",Le,[a(e(c),{icon:e(ve),class:"info-icon"},null,8,["icon"]),o("span",null,s(t.indirizzoNegozio)+", "+s(t.cittaNegozio),1)]),o("div",Me,[a(e(c),{icon:e(he),class:"info-icon"},null,8,["icon"]),t.servizioSelezionato?(r(),u("span",Ve,s(t.servizioSelezionato.nome),1)):_("",!0)])]),t.ordine?(r(),u("div",He,[o("div",{class:U(["status-badge",K(t.stato)])},s(t.stato),3),o("div",Fe,[t.noteAggiuntive?(r(),u("div",Ue,[a(e(c),{icon:e(we),class:"note-icon"},null,8,["icon"]),o("span",null,s(t.noteAggiuntive),1)])):_("",!0),t.allergie?(r(),u("div",Re,[a(e(c),{icon:e(De),class:"warning-icon"},null,8,["icon"]),o("span",null,s(t.allergie),1)])):_("",!0)]),o("div",$e,[a(e(H),{class:"order-button",fill:"solid",onClick:m=>R(t.ordine)},{default:l(()=>[a(e(c),{slot:"start",icon:e(ke)},null,8,["icon"]),i[1]||(i[1]=v(" Visualizza Ordine "))]),_:2},1032,["onClick"]),t.stato==="Accettato"?(r(),u("div",je,[a(e(c),{icon:e(Ie),class:"queue-icon"},null,8,["icon"]),o("span",null,"Posizione in coda: "+s(t.prenotazioniPrima+1),1)])):_("",!0)])])):(r(),u("div",Je,[o("div",Ke,[o("div",We,[a(e(c),{icon:e(Ne),style:{"font-size":"1.5rem"}},null,8,["icon"]),o("span",null,s(t.durataServizioSelezionato)+" min",1)]),o("div",Xe,[a(e(c),{icon:e(Pe),style:{"font-size":"1.5rem"}},null,8,["icon"]),o("span",null,s(t.oraInizio),1)]),o("div",Ze,[a(e(c),{icon:e(Ce),style:{"font-size":"1.5rem"}},null,8,["icon"]),o("span",null,s(t.oraFine),1)])]),t.commento?(r(),u("div",Ge,[a(e(c),{icon:e(be),class:"comment-icon"},null,8,["icon"]),o("p",null,s(t.commento),1)])):_("",!0)]))]),_:2},1024)]),_:2},1024))),128))])),a(e(re),{"is-open":I.value,onDidDismiss:b,class:"custom-modal",breakpoints:[0,.9],initialBreakpoint:.9},{default:l(()=>[o("div",Ye,[a(e(B),{color:"primary",class:"modal-header"},{default:l(()=>[a(e(L),null,{default:l(()=>i[3]||(i[3]=[v("Dettaglio Ordine")])),_:1}),a(e(ce),{slot:"end"},{default:l(()=>[a(e(H),{onClick:b,class:"close-button"},{default:l(()=>[a(e(c),{icon:e(de)},null,8,["icon"])]),_:1})]),_:1})]),_:1}),a(e(F),{class:"modal-body"},{default:l(()=>[o("div",et,[(r(!0),u(M,null,V(N.value,(t,m)=>(r(),u("div",{key:m,class:"order-item"},[o("div",{class:U(["item-content",{"item-completed":t.fatto}])},[o("div",tt,[o("span",ot,s(t.name),1),o("span",at,"x"+s(t.quantity),1)]),t.ingredienti?(r(),u("div",nt,s(t.ingredienti.join(", ")),1)):_("",!0)],2)]))),128))]),o("div",it,[o("div",st,[i[4]||(i[4]=v(" Articoli totali: ")),o("strong",null,s($()),1)])])]),_:1})])]),_:1},8,["is-open"])]),_:1})]),_:1}))}},dt=G(lt,[["__scopeId","data-v-0540fdcd"]]);export{dt as default};
