import{_ as Ce,g as ye,b as ke,r as C,o as ze,aI as be,aJ as Ie,h as I,s,u as e,k as Pe,q as we,w as Ae,l as De,a3 as ce,aA as xe,p as r,t,I as re,aK as Te,aL as j,a1 as w,x as m,U as c,z as de,B as f,ab as y,P as G,F as V,C as N,K as H,v as Oe,L as Ve,M as P,H as d,N as Ne,O as ue,A as n,y as $e,Q as Ee,R as Me,a0 as K,aM as Q,aN as W,aO as ve,aD as J,aP as X,$ as Y,ac as Z,aQ as me,ae as ee,aR as Se,aS as Be,aT as Le,T as Re,aU as Ue,aG as $,f as E}from"./index-Bp7GJEX9.js";import{A as qe}from"./AlertInformazioniPrenotazione-B565EOBY.js";const Fe={key:0,style:{display:"flex","justify-content":"center","align-items":"center",height:"100vh","font-size":"18px","font-weight":"bold",color:"#555"}},je={key:1,class:"section"},Ge={class:"prenotazione-header"},He={class:"header-content"},Ke={class:"customer-name"},Qe={class:"booking-time"},We={class:"prenotazione-details"},Je={class:"datetime-container"},Xe={class:"info-grid"},Ye={key:0,class:"info-item-address-info"},Ze={class:"info-text"},et={class:"info-item"},tt={class:"info-text"},at={class:"info-item"},ot={class:"info-text"},nt={class:"prenotazione-actions"},st={class:"decision-buttons"},it={key:2,class:"section"},lt={key:0,style:{display:"flex","justify-content":"center","align-items":"center",height:"100vh","font-size":"18px","font-weight":"bold",color:"#555"}},ct={class:"prenotazione-header"},rt={class:"header-content"},dt={class:"customer-name"},ut={class:"booking-time"},vt={class:"prenotazione-details"},mt={class:"datetime-container"},ft={class:"info-grid"},_t={key:0,class:"info-item-address-info"},gt={class:"info-text"},ht={class:"info-item"},pt={class:"info-text"},Ct={class:"info-item"},yt={class:"info-text"},kt={class:"prenotazione-actions"},zt={key:3,class:"section"},bt={class:"prenotazione-header"},It={class:"header-content"},Pt={class:"customer-name"},wt={class:"booking-time"},At={class:"prenotazione-details"},Dt={class:"datetime-container"},xt={class:"info-grid"},Tt={key:0,class:"info-item-address-info"},Ot={class:"info-text"},Vt={class:"info-item"},Nt={class:"info-text"},$t={class:"info-item"},Et={class:"prenotazione-actions"},Mt={class:"order-container"},St={class:"order-list"},Bt={class:"item-info"},Lt={class:"item-name"},Rt={class:"item-quantity"},Ut={__name:"PrenotazioniGestoreAlimentari",setup(qt){const A=ye(),fe=ke(),D=C("daAccettare"),b=C([]),z=C([]),T=C([]),M=C(!1),S=C([]),B=C(!1),te=C(null),h=C(!1),p=C(!1),k=C(""),L=i=>{var a;try{const v=((a=i==null?void 0:i.toDate)==null?void 0:a.call(i))||new Date(i);return new Intl.DateTimeFormat("it-IT",{day:"2-digit",month:"2-digit",year:"numeric"}).format(v)}catch(v){return console.error("Error formatting date:",v),"Data non disponibile"}},ae=i=>(i==null?void 0:i.reduce((a,v)=>a+(v.quantity||0),0))||0,x=async()=>{const i=fe.currentUser;if(i){h.value=!0;try{const a=Pe(A,"Prenotazioni"),v=we(a,Ae("proprietarioUid","==",i.uid)),o=await De(v),u=(l=>l.map(g=>({id:g.id,...g.data(),dataPrenotazione:g.data().dataPrenotazione||ce.now()})))(o.docs);b.value=u.filter(l=>!l.stato||l.stato==="Da accettare").sort((l,g)=>l.dataPrenotazione-g.dataPrenotazione),z.value=u.filter(l=>l.stato==="Accettato").sort((l,g)=>l.dataPrenotazione-g.dataPrenotazione),T.value=u.filter(l=>l.stato==="Completato").sort((l,g)=>l.dataPrenotazione-g.dataPrenotazione)}catch(a){console.error("Fetch error:",a),k.value="Errore nel caricamento delle prenotazioni",p.value=!0}finally{h.value=!1}}},_e=async i=>{h.value=!0;try{await $(E(A,"Prenotazioni",i),{stato:"Accettato"}),await x(),k.value="Prenotazione accettata con successo",p.value=!0}catch(a){console.error("Accept error:",a),k.value="Errore durante l'accettazione",p.value=!0}finally{h.value=!1}},ge=async i=>{h.value=!0;try{await $(E(A,"Prenotazioni",i),{stato:"Rifiutata"}),await x(),k.value="Prenotazione rifiutata con successo",p.value=!0}catch(a){console.error("Reject error:",a),k.value="Errore durante il rifiuto",p.value=!0}finally{h.value=!1}},he=async i=>{h.value=!0;try{await $(E(A,"Prenotazioni",i.id),{stato:"Completato"}),T.value.push(i),z.value=z.value.filter(a=>a.id!==i.id),k.value="Ordine completato con successo",p.value=!0}catch(a){console.error("Complete error:",a),k.value="Errore durante il completamento",p.value=!0}finally{h.value=!1}},oe=async(i,a)=>{h.value=!0;try{let v=a.detail.value;if(![...b.value,...z.value].find(q=>q.id===i))throw new Error("Prenotazione non trovata");const u=new Date().toISOString().split("T")[0],l="".concat(u,"T").concat(v,":00"),g=new Date(l);if(isNaN(g.getTime()))throw new Error("La data generata non Ã¨ valida");const ie=ce.fromDate(g);await $(E(A,"Prenotazioni",i),{dataPrenotazione:ie});const le=q=>q.map(F=>F.id===i?{...F,dataPrenotazione:ie}:F);b.value=le(b.value),z.value=le(z.value),k.value="Orario modificato con successo",p.value=!0}catch(v){console.error("Errore durante la modifica dell'orario:",v),k.value="Errore nella modifica dell'orario",p.value=!0}finally{h.value=!1}},R=i=>{S.value=i.map(a=>({...a,fatto:!1})),M.value=!0},ne=()=>{M.value=!1,S.value=[]},U=i=>{te.value=i,B.value=!0};function pe(){B.value=!1}let O=null;const se=()=>{O=setInterval(async()=>{await x()},5e4)};return ze(async()=>{await x(),se()}),be(async()=>{await x(),se()}),Ie(()=>{O&&(clearInterval(O),O=null)}),(i,a)=>{const v=xe("ng-template");return r(),I(e(Me),null,{default:s(()=>[t(e(de),null,{default:s(()=>[t(e(re),{color:"primary"},{default:s(()=>[t(e(Te),{modelValue:D.value,"onUpdate:modelValue":a[0]||(a[0]=o=>D.value=o),onIonChange:i.segmentChanged,class:"custom-segment"},{default:s(()=>[t(e(j),{value:"accettati",class:"segment-button"},{default:s(()=>[t(e(w),{class:"segment-label"},{default:s(()=>[m("In corso ("+c(z.value.length)+")",1)]),_:1})]),_:1}),t(e(j),{value:"daAccettare",class:"segment-button"},{default:s(()=>[t(e(w),{class:"segment-label"},{default:s(()=>[m("Nuovi ("+c(b.value.length)+")",1)]),_:1})]),_:1}),t(e(j),{value:"Completati",class:"segment-button"},{default:s(()=>[t(e(w),{class:"segment-label"},{default:s(()=>[m("Completati ("+c(T.value.length)+")",1)]),_:1})]),_:1})]),_:1},8,["modelValue","onIonChange"])]),_:1})]),_:1}),t(e(ue),{class:"ion-padding-horizontal"},{default:s(()=>[b.value.length===0?(r(),f("p",Fe," Nessuna prenotazione disponibile ")):y("",!0),D.value==="daAccettare"?(r(),f("div",je,[t(e(G),{lines:"none"},{default:s(()=>[(r(!0),f(V,null,N(b.value,o=>(r(),I(e(K),{key:o.id,class:"prenotazione-item"},{default:s(()=>[t(e(w),{class:"ion-text-wrap"},{default:s(()=>{var _,u;return[n("div",Ge,[n("div",He,[n("h2",Ke,c(o.nomeCliente),1),t(e(Q),{class:"customer-avatar",onClick:l=>U(o)},{default:s(()=>a[3]||(a[3]=[n("img",{alt:"Avatar",src:"https://ionicframework.com/docs/img/demos/avatar.svg"},null,-1)])),_:2},1032,["onClick"])]),n("time",Qe,c(L(o.dataPrenotazione)),1)]),n("div",We,[n("div",Je,[a[4]||(a[4]=n("p",{style:{"font-size":"xx-small",color:"orange"}},"Tocca l'orario per modificarlo",-1)),t(e(W),{datetime:"datetime-"+o.id,class:"datetime-button"},null,8,["datetime"]),t(e(H),{keepContentsMounted:"true"},{default:s(()=>[t(v,null,{default:s(()=>[t(e(ve),{id:"datetime-"+o.id,presentation:"time",value:o.dataPrenotazione.toDate().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),onIonChange:l=>oe(o.id,l),class:"time-picker"},null,8,["id","value","onIonChange"])]),_:2},1024)]),_:2},1024)]),n("div",Xe,[o.consegnaACasa?(r(),f("div",Ye,[o.consegnaACasa?(r(),I(e(J),{key:0,color:"warning",class:"delivery-badge"},{default:s(()=>[t(e(d),{icon:e(X),class:"badge-icon"},null,8,["icon"]),a[5]||(a[5]=m(" A domicilio "))]),_:1})):y("",!0),t(e(d),{icon:e(Y),class:"info-icon"},null,8,["icon"]),n("span",Ze,c((_=o.indirizzoConsegna)==null?void 0:_.via)+" "+c((u=o.indirizzoConsegna)==null?void 0:u.civico),1)])):y("",!0),n("div",et,[t(e(d),{icon:e(Z),class:"info-icon"},null,8,["icon"]),n("span",tt,c(o.noteAggiuntive||"Nessuna nota aggiuntiva"),1)]),n("div",at,[t(e(d),{icon:e(me),class:"info-icon"},null,8,["icon"]),n("span",ot,"Totale: "+c(ae(o.ordine)),1)])])]),n("div",nt,[t(e(P),{fill:"outline",onClick:l=>R(o.ordine),class:"action-button"},{default:s(()=>[t(e(d),{slot:"start",icon:e(ee)},null,8,["icon"]),a[6]||(a[6]=m(" Dettaglio ordine "))]),_:2},1032,["onClick"]),n("div",st,[t(e(P),{color:"success",onClick:l=>_e(o.id),class:"decision-button"},{default:s(()=>[t(e(d),{slot:"start",icon:e(Se)},null,8,["icon"]),a[7]||(a[7]=m(" Accetta "))]),_:2},1032,["onClick"]),t(e(P),{color:"danger",onClick:l=>ge(o.id),class:"decision-button"},{default:s(()=>[t(e(d),{slot:"start",icon:e(Be)},null,8,["icon"]),a[8]||(a[8]=m(" Rifiuta "))]),_:2},1032,["onClick"])])])]}),_:2},1024)]),_:2},1024))),128))]),_:1})])):y("",!0),D.value==="accettati"?(r(),f("div",it,[z.value.length===0?(r(),f("p",lt," Nessuna prenotazione disponibile ")):y("",!0),t(e(G),{lines:"none"},{default:s(()=>[(r(!0),f(V,null,N(z.value,o=>(r(),I(e(K),{key:o.id,class:"prenotazione-item elevation"},{default:s(()=>[t(e(w),{class:"ion-text-wrap"},{default:s(()=>{var _,u;return[n("div",ct,[n("div",rt,[n("h2",dt,c(o.nomeCliente),1),t(e(Q),{class:"customer-avatar",onClick:l=>U(o)},{default:s(()=>a[9]||(a[9]=[n("img",{alt:"Avatar",src:"https://ionicframework.com/docs/img/demos/avatar.svg"},null,-1)])),_:2},1032,["onClick"])]),n("time",ut,c(L(o.dataPrenotazione)),1)]),n("div",vt,[n("div",mt,[a[10]||(a[10]=n("p",{style:{"font-size":"xx-small",color:"orange"}},"Tocca l'orario per modificarlo",-1)),t(e(W),{datetime:"datetime-"+o.id,class:"datetime-button"},null,8,["datetime"]),t(e(H),{keepContentsMounted:"true"},{default:s(()=>[t(v,null,{default:s(()=>[t(e(ve),{id:"datetime-"+o.id,presentation:"time",value:o.dataPrenotazione.toDate().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),onIonChange:l=>oe(o.id,l),class:"time-picker"},null,8,["id","value","onIonChange"])]),_:2},1024)]),_:2},1024)]),n("div",ft,[o.consegnaACasa?(r(),f("div",_t,[o.consegnaACasa?(r(),I(e(J),{key:0,color:"warning",class:"delivery-badge"},{default:s(()=>[t(e(d),{icon:e(X),class:"badge-icon"},null,8,["icon"]),a[11]||(a[11]=m(" A domicilio "))]),_:1})):y("",!0),t(e(d),{icon:e(Y),class:"info-icon"},null,8,["icon"]),n("span",gt,c((_=o.indirizzoConsegna)==null?void 0:_.via)+" "+c((u=o.indirizzoConsegna)==null?void 0:u.civico),1)])):y("",!0),n("div",ht,[t(e(d),{icon:e(Z),class:"info-icon"},null,8,["icon"]),n("span",pt,c(o.noteAggiuntive||"Nessuna nota aggiuntiva"),1)]),n("div",Ct,[t(e(d),{icon:e(me),class:"info-icon"},null,8,["icon"]),n("span",yt,"Totale: "+c(ae(o.ordine)),1)])])]),n("div",kt,[t(e(P),{fill:"outline",onClick:l=>R(o.ordine),class:"action-button"},{default:s(()=>[t(e(d),{slot:"start",icon:e(ee)},null,8,["icon"]),a[12]||(a[12]=m(" Dettaglio ordine "))]),_:2},1032,["onClick"]),t(e(P),{color:"secondary",onClick:l=>he(o),class:"complete-button"},{default:s(()=>[t(e(d),{slot:"start",icon:e(Le)},null,8,["icon"]),a[13]||(a[13]=m(" Completa Ordine "))]),_:2},1032,["onClick"])])]}),_:2},1024)]),_:2},1024))),128))]),_:1})])):y("",!0),D.value==="Completati"?(r(),f("div",zt,[t(e(G),{lines:"none"},{default:s(()=>[(r(!0),f(V,null,N(T.value,o=>(r(),I(e(K),{key:o.id,class:"prenotazione-item"},{default:s(()=>[t(e(w),{class:"ion-text-wrap"},{default:s(()=>{var _,u;return[n("div",bt,[n("div",It,[n("h2",Pt,c(o.nomeCliente),1),t(e(Q),{class:"customer-avatar",onClick:l=>U(o)},{default:s(()=>a[14]||(a[14]=[n("img",{alt:"Avatar",src:"https://ionicframework.com/docs/img/demos/avatar.svg"},null,-1)])),_:2},1032,["onClick"])]),n("time",wt,c(L(o.dataPrenotazione)),1)]),n("div",At,[n("div",Dt,[t(e(W),{datetime:"datetime-"+o.id,class:"datetime-button",disabled:""},null,8,["datetime"])]),n("div",xt,[o.consegnaACasa?(r(),f("div",Tt,[o.consegnaACasa?(r(),I(e(J),{key:0,color:"warning",class:"delivery-badge"},{default:s(()=>[t(e(d),{icon:e(X),class:"badge-icon"},null,8,["icon"]),a[15]||(a[15]=m(" A domicilio "))]),_:1})):y("",!0),t(e(d),{icon:e(Y),class:"info-icon"},null,8,["icon"]),n("span",Ot,c((_=o.indirizzoConsegna)==null?void 0:_.via)+" "+c((u=o.indirizzoConsegna)==null?void 0:u.civico),1)])):y("",!0),n("div",Vt,[t(e(d),{icon:e(Z),class:"info-icon"},null,8,["icon"]),n("span",Nt,c(o.noteAggiuntive||"Nessuna nota aggiuntiva"),1)]),n("div",$t,[t(e(d),{icon:i.pizzaOutline,class:"info-icon"},null,8,["icon"])])])]),n("div",Et,[t(e(P),{fill:"outline",onClick:l=>R(o.ordine),class:"action-button"},{default:s(()=>[t(e(d),{slot:"start",icon:e(ee)},null,8,["icon"]),a[16]||(a[16]=m(" Rivedi ordine "))]),_:2},1032,["onClick"])])]}),_:2},1024)]),_:2},1024))),128))]),_:1})])):y("",!0),t(e(H),{"is-open":M.value,onDidDismiss:ne,class:"order-modal"},{default:s(()=>[t(e(de),null,{default:s(()=>[t(e(re),{color:"primary"},{default:s(()=>[t(e(Oe),null,{default:s(()=>a[17]||(a[17]=[m("Dettaglio Ordine")])),_:1}),t(e(Ve),{slot:"end"},{default:s(()=>[t(e(P),{onClick:ne,class:"close-button"},{default:s(()=>[t(e(d),{icon:e(Ne)},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),t(e(ue),{class:"ion-padding"},{default:s(()=>[n("div",Mt,[n("ul",St,[(r(!0),f(V,null,N(S.value,(o,_)=>(r(),f("li",{key:_,class:Re(["order-item",{"item-completed":o.fatto}])},[t(e(Ue),{modelValue:o.fatto,"onUpdate:modelValue":u=>o.fatto=u,class:"order-checkbox",color:"primary"},null,8,["modelValue","onUpdate:modelValue"]),n("div",Bt,[n("span",Lt,c(o.name),1),n("span",Rt,"x"+c(o.quantity),1)])],2))),128))]),a[18]||(a[18]=n("div",{class:"order-summary"},[n("span",{class:"total-label"},"Totale articoli:")],-1))])]),_:1})]),_:1},8,["is-open"]),t(e($e),{"is-open":h.value,message:"Elaborazione in corso...",spinner:"circles",class:"custom-loading"},null,8,["is-open"]),t(e(Ee),{"is-open":p.value,message:k.value,duration:3e3,onDidDismiss:a[1]||(a[1]=o=>p.value=!1),position:"top",class:"custom-toast"},null,8,["is-open","message"])]),_:1}),t(qe,{"is-open":B.value,prenotazioneSelected:te.value,onCloseModal:a[2]||(a[2]=o=>pe())},null,8,["is-open","prenotazioneSelected"])]),_:1})}}},Gt=Ce(Ut,[["__scopeId","data-v-1b68a4dc"]]);export{Gt as default};
