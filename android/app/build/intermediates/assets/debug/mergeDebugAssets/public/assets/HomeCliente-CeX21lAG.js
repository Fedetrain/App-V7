import{_ as ee,g as ae,a as oe,b as se,r,c as te,d as le,o as ne,e as re,f as ie,h as z,u as o,i as ce,j as ue,q as de,k as me,w as ge,l as ve,m as pe,n as fe,p as c,s as l,t,I as M,v as P,x as f,y as Ce,z as V,A as i,B as N,C as b,F as w,D as k,E as A,G as H,H as D,J as he,K as ze,L as _e,M as ye,N as Ie,O,P as Ne,Q as be,R as we,S as ke,T as De,U as m,V as Te,W as Se,X as Ue,Y as Be,Z as Ee,$ as Le,a0 as xe,a1 as $e}from"./index-Bp7GJEX9.js";const Me={class:"category-filters"},Pe={class:"search-container"},Ve={class:"empty-state"},Ae={class:"shop-grid"},He={class:"image-container"},Oe=["src"],je={class:"category-badge"},qe={class:"address-line"},Fe={__name:"HomeCliente",setup(Re){const T=ae(),j=oe(),q=se(),S=ce(),F=ue(),g=r(!1),_=r(!1),y=r(0),u=r([]),C=r([]),v=r(""),U=r([]),h=r(!1),d=r(null),I=r(!1),B=r(""),R=r(["Tutti","Alimentari e cibo","Servizi di estetica e bellezza"]),G=te.map(s=>s.nome),J=le(()=>C.value.filter(s=>!d.value||d.value==="Tutti"||s.categoriaNegozio===d.value)),K=s=>{d.value=d.value===s?null:s},Q=()=>{h.value=!0},E=()=>{h.value=!1},W=s=>{const a=s.target.value.split(" ").map(n=>n.charAt(0).toUpperCase()+n.slice(1)).join(" ");U.value=G.filter(n=>n.includes(a)).slice(0,30)},X=async s=>{try{g.value=!0,v.value=s,await L(s),await x(),h.value=!1}catch(e){p("Errore nel caricamento dei negozi")}finally{g.value=!1}},Y=s=>{const e=s.target.value.toLowerCase();C.value=u.value.filter(a=>a.nomeNegozio.toLowerCase().includes(e))},L=async s=>{try{const e=de(me(T,"Negozi"),ge("cittaNegozio","==",s)),a=await ve(e);u.value=a.docs.map(n=>({id:n.id,...n.data()})),C.value=[...u.value]}catch(e){p("Errore nel caricamento dei negozi")}},x=async()=>{try{_.value=!0,y.value=0,u.value=await Promise.all(u.value.map(async(s,e)=>{try{const a=pe(j,"images/".concat(s.id));s.imageUrl=await fe(a)}catch(a){s.imageUrl="/assets/default-shop.jpg"}return y.value=(e+1)/u.value.length*100,s}))}catch(s){p("Errore nel caricamento delle immagini")}finally{_.value=!1}},Z=s=>{try{S.dispatch("setIdDocumentNegozioSelezionato",s.id),S.dispatch("setUrlNegozioSelezionato",s.imageUrl);const e=s.categoriaNegozio==="Alimentari e cibo"?"/cliente/tabs/tab1/informazioniNegozio_Alimentari":"/cliente/tabs/tab1/informazioniNegozio";F.push(e)}catch(e){p("Errore nell'apertura del negozio")}},p=s=>{B.value=s,I.value=!0};return ne(async()=>{var s;try{const e=(s=q.currentUser)==null?void 0:s.uid;if(!e)return;const a=await re(ie(T,"Cliente",e));a.exists()&&(v.value=a.data().citta,await L(v.value),await x()),g.value=!1}catch(e){g.value=!1,p("Errore nel caricamento iniziale")}}),(s,e)=>(c(),z(o(we),null,{default:l(()=>[t(o(V),null,{default:l(()=>[t(o(M),{color:"primary"},{default:l(()=>[t(o(P),null,{default:l(()=>e[5]||(e[5]=[f("Home")])),_:1}),t(o(Ce),{"is-open":g.value,message:"Caricamento...",spinner:"circles"},null,8,["is-open"])]),_:1})]),_:1}),t(o(O),{class:"ion-padding main-content"},{default:l(()=>[i("div",Me,[(c(!0),N(w,null,b(R.value,(a,n)=>(c(),z(o(ke),{key:n,class:De({"active-category":d.value===a}),onClick:$=>K(a)},{default:l(()=>[f(m(a),1)]),_:2},1032,["class","onClick"]))),128))]),i("div",Pe,[t(o(k),{class:"custom-searchbar",animated:"",placeholder:"Cerca per nome",debounce:500,onIonInput:e[0]||(e[0]=a=>Y(a))}),t(o(k),{class:"custom-searchbar",modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=a=>v.value=a),animated:"",placeholder:"Cerca per città",onClick:e[2]||(e[2]=a=>Q())},null,8,["modelValue"])]),A(i("div",Ve,[t(o(D),{icon:o(he),class:"empty-icon"},null,8,["icon"]),e[6]||(e[6]=i("p",{class:"empty-text"},"Nessun negozio trovato",-1))],512),[[H,C.value.length===0]]),i("div",Ae,[(c(!0),N(w,null,b(J.value,(a,n)=>(c(),z(o(Te),{class:"shop-card",key:n,onClick:$=>Z(a)},{default:l(()=>[i("div",He,[i("img",{class:"shop-image",src:a.imageUrl,alt:"Immagine negozio",loading:"lazy"},null,8,Oe),i("div",je,m(a.categoriaNegozio),1)]),t(o(Se),{class:"card-header"},{default:l(()=>[t(o(Ue),{class:"shop-title"},{default:l(()=>[f(m(a.nomeNegozio),1)]),_:2},1024),A(t(o(Be),{value:y.value/100,class:"loading-bar"},null,8,["value"]),[[H,_.value]])]),_:2},1024),t(o(Ee),{class:"card-content"},{default:l(()=>[i("div",qe,[t(o(D),{icon:o(Le)},null,8,["icon"]),i("p",null,m(a.indirizzoNegozio)+", "+m(a.cittaNegozio),1)])]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),t(o(ze),{"is-open":h.value,onDidDismiss:E,class:"city-modal"},{default:l(()=>[t(o(V),null,{default:l(()=>[t(o(M),{color:"primary"},{default:l(()=>[t(o(P),null,{default:l(()=>e[7]||(e[7]=[f("Seleziona Città")])),_:1}),t(o(_e),{slot:"end"},{default:l(()=>[t(o(ye),{onClick:E},{default:l(()=>[t(o(D),{icon:o(Ie)},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),t(o(O),{class:"modal-content"},{default:l(()=>[t(o(k),{class:"modal-searchbar",animated:"",placeholder:"Cerca città...",onIonInput:e[3]||(e[3]=a=>W(a))}),t(o(Ne),{class:"city-list"},{default:l(()=>[(c(!0),N(w,null,b(U.value,(a,n)=>(c(),z(o(xe),{key:n,onClick:$=>X(a),class:"city-item"},{default:l(()=>[t(o($e),null,{default:l(()=>[f(m(a),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1},8,["is-open"]),t(o(be),{"is-open":I.value,message:B.value,duration:3e3,onDidDismiss:e[4]||(e[4]=a=>I.value=!1),color:"danger"},null,8,["is-open","message"])]),_:1})]),_:1}))}},Je=ee(Fe,[["__scopeId","data-v-f583b019"]]);export{Je as default};
